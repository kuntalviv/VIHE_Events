<!DOCTYPE html>
<html>

<head>
    <title>VIHE Events</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <p id="portrait_warning" class="portrait-text"><span id="portrait_warning_icon"> &#128712; </span><i>For better experience, please use landscape mode.</i></p>
    <section id="template_links">
        <a href="#" onclick="addTemplate('auditorium'); return false;">Auditorium Items</a>
        <a href="#" onclick="addTemplate('rally'); return false;">Rally Items</a>
    </section>
    <section id="main">
        <h3 id="item_name">Item Name</h3>
        <h3 id="item_count">Item Count</h3>
        <h3 id="taken">Taken</h3>
        <h3 id="returned">Returned</h3>
        <h3 id="actions">Actions</h3>
        <input type="text" />
        <input type="text" />
        <input type="checkbox" />
        <input type="checkbox" />
        <section class="actions">
            <button type="button" onclick="addRow(this)">Add</input>
            <button type="button" onclick="deleteRow(this)">Delete</input>
        </section>
    </section>

</body>

<style>
    @media screen and (max-width: 600px) {
        body {
            writing-mode: sideways-lr;
        }

        input[type="checkbox"] {
            transform: rotate(-90deg);
            height: 1em;
            
        }
    }

    @media screen and (orientation: portrait) {
        .portrait-text { display: block; }
    }
    @media screen and (orientation: landscape) {
        .portrait-text { display: none; }
    }

    .template_links {
        display: flex;
        margin: 5em;
    }



    span#portrait_warning_icon {
        font-size: large;
    }

    section#main {
        display:grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 2vw;
        justify-items: center;
    }
    section.actions {
        display: flex;
        justify-content: space-evenly;
    }
    
    h3 {
        margin-inline:5vw;
        text-align: center;
    }

    button {
        grid-column: 5;
    }

    a {
        padding: 10px;
    }
</style>

<script>


    let loaded_template = "";
    const templates = {
        rally : [
            {
                item_name: "Big National Flags",
                item_count: 2
            },
            {
                item_name: "Small National Flags",
                item_count: 6 
            },
            {
                item_name: "Quotation Banners",
                item_count: 14
            }
        ],

        auditorium : [
            {
                item_name: "Holy Trio Photo with Stands",
                item_count: 3
            },
            {
                item_name: "Deep Prajwalan Lamp",
                item_count: 1
            },
            {
                item_name: "Deep Prajwalan Wicks",
                item_count: 5
            },
            {
                item_name: "Deep Prajwalan Karpooram",
                item_count: "1 packet"
            },
            {
                item_name: "Deep Prajwalan Oil",
                item_count: "1 bottle"
            },
            {
                item_name: "Deep Prajwalan Agarbatti",
                item_count: "4"
            },
            {
                item_name: "Deep Prajwalan Loose Petals",
                item_count: "1 basket"
            },
            {
                item_name: "Deep Prajwalan Matchbox",
                item_count: "1"
            },
            {
                item_name: "Holy Trio Garlands",
                item_count: "3"
            },
            {
                item_name: "Guest Nameplates",
                item_count: "as per requirement"
            },
            {
                item_name: "Water Bottles",
                item_count: "as per requirement"
            },
            {
                item_name: "Event Schedule Copies",
                item_count: "as per requirement"
            },
            {
                item_name: "Momentos/Books/Cloth",
                item_count: "as per requirement"
            },
            {
                item_name: "Chairs with cloth",
                item_count: "as per requirement"
            },
            {
                item_name: "T Pie",
                item_count: "as per requirement"
            },
        ]
    }

    const addTemplate = (template_type) => {
        
        if (!Object.hasOwn(templates, template_type)) return;
        const all_checkboxes = document.querySelectorAll("input[type='checkbox']");
        for(let i = 0; i < all_checkboxes.length; i++) {
            all_checkboxes[i].checked = false;
        }

        const items_list = templates[template_type];
        const text_inputs = document.querySelectorAll("input[type='text']");

        let i = 0;
        let j = 0;
        items_list_length = items_list.length;
        text_inputs_length = text_inputs.length;
        while(true) {
            
            if(i >= items_list_length && j < text_inputs_length) {
                const main_section = document.querySelector("section#main");
                const actions_section = main_section.querySelector("section:last-of-type");
                if(actions_section) {
                    const delete_btn = actions_section.children[1];
                    delete_btn.click();
                    text_inputs_length -= 2;
                }

                continue;
            }

            else if (i < items_list_length && j >= text_inputs_length) {
                const main_section = document.querySelector("section#main");
                const actions_section = main_section.querySelector("section:last-of-type");
                if(actions_section) {
                    const add_btn = actions_section.children[0];
                    add_btn.click();
                    text_inputs_length += 2;
                }
                
                let new_input = main_section.querySelector("input:last-of-type").previousElementSibling.previousElementSibling;
                new_input.value = items_list[i].item_count || 0;
                new_input = new_input.previousElementSibling;
                new_input.value = items_list[i].item_name || "<empty>";
                
                i += 1;
                j += 2;

                continue;
                
            }

            else if (i >= items_list_length && j >= text_inputs_length) {
                break;
            }

            text_inputs[j].value = items_list[i].item_name || "<empty>" ;
            text_inputs[j+1].value = items_list[i].item_count || 0 ;
            i += 1;
            j += 2;
        }

        loaded_template = template_type;
    }

    const addRow = (clicked_btn, item) => {

        let old_element = clicked_btn.parentElement;
        let new_element = document.createElement("input");
        new_element.type = "text";
        old_element.after(new_element);
        
        old_element = new_element;
        new_element = document.createElement("input");
        new_element.type = "text";
        old_element.after(new_element);

        old_element = new_element;
        new_element = document.createElement("input");
        new_element.type = "checkbox";
        old_element.after(new_element);

        old_element = new_element;
        new_element = document.createElement("input");
        new_element.type = "checkbox";
        old_element.after(new_element);


        old_element = new_element;
        new_element = document.createElement("section");
        new_element.classList.add("actions");
        old_element.after(new_element);

        old_element = new_element;
        new_element = document.createElement("button");
        new_element.type = "button";
        new_element.addEventListener("click", (ptr_event) => {addRow(ptr_event.target)});
        new_element.innerText = "Add";
        old_element.appendChild(new_element);

        new_element = document.createElement("button");
        new_element.type = "button";
        new_element.addEventListener("click", (ptr_event) => {deleteRow(ptr_event.target)});
        new_element.innerText = "Delete";
        old_element.appendChild(new_element);


   }

   const deleteRow = (clicked_btn) => {
        const actions_element = document.getElementsByClassName("actions");
        if(!actions_element) { return; }
        if(actions_element.length === 1) { 
            const inputs = document.getElementsByTagName("input");
            Array.from(document.getElementsByTagName("input")).forEach(element => {
                if(element.type === "text") {
                    element.value = "";
                } else if(element.type === "checkbox") {
                    element.checked = false;
                }
            });
            return; 
        }
        
        let old_element = clicked_btn.parentElement;
        let new_element = old_element.previousElementSibling;
        old_element.remove();

        let count = 4;
        while(count--) {
            old_element = new_element;
            new_element = old_element.previousElementSibling;
            old_element.remove();
        }
   }
</script>

</html>
